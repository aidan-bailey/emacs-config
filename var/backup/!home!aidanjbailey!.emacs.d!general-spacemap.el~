(windresize-set-increment 8)

;; Macros

(fset 'frame-alternate
      "\C-xo")
(fset 'pdf-page-down
      "\C-xoj\C-xo")
(fset 'pdf-page-up
      "\C-xok\C-xo")

;; Functions

(defun 2-windows-vertical-to-horizontal ()
  (let ((buffers (mapcar 'window-buffer (window-list))))
    (when (= 2 (length buffers))
      (delete-other-windows)
      (set-window-buffer (split-window-horizontally) (cadr buffers)))))
(add-hook 'emacs-startup-hook '2-windows-vertical-to-horizontal)


(defun nin-origami-toggle-node ()
  (interactive)
  (save-excursion ;; leave point where it is
    (goto-char (point-at-eol))             ;; then go to the end of line
    (origami-toggle-node (current-buffer) (point))))                 ;; and try to fold

(defun company-idle-toggle()
  (interactive)
  "Toggle companies complete mode delay to near infinite."
  (if (= company-idle-delay 999999)
      (setq company-idle-delay 0)
    (setq company-idle-delay 999999)
    )
  )
(setq flycheck-inline-display-function
      (lambda (msg pos)
        (unless (eq evil-state 'insert)
	  (let* ((ov (quick-peek-overlay-ensure-at pos))
		 (contents (quick-peek-overlay-contents ov)))
	    (setf (quick-peek-overlay-contents ov)
		  (concat contents (when contents "\n") msg))
	    (quick-peek-update ov))))
      flycheck-inline-clear-function #'quick-peek-hide)

;; Space Binds

(general-def
  :states 'normal
  :keymaps 'override
  :prefix "SPC"

  ;; Shell
  "s" 'term

  ;; Help binds
  "a" 'helm-apropos
  "w" 'whichkey-show-major-mode

  ;; IDE Binds
  "id"   'realgud
  "im"   'helm-make-projectile
  ;"if"   'format-all-buffer
  "if"   'lsp-format-buffer
  

  ;; Helm Binds
  "SPC" 'helm-M-x

  ;; LSP Binds
  "ld" 'lsp-ui-doc-glance
  "lf" 'lsp-format-buffer

  ;; File Binds
  "ff" 'helm-find-files

  ;; Project Binds
  "pf" 'helm-projectile
  "pr" 'helm-projectile-recentf
  "pb" 'ibuffer-filter-by-projectile-files
  "pn" 'neotree-projectile-action
  "pc" 'helm-projectile-compile-project

  ;; Buffer Binds
  "bw" 'evil-write-all
  "bq" 'evil-quit-all
  "bd" 'kill-this-buffer
  "bn" 'next-buffer
  "bp" 'previous-buffer
  "bm" 'buffer-menu
  "bb" 'bury-buffer
  "bu" 'unbury-buffer

  ;; Directory Binds
  "n" 'neotree-toggle

  ;; Folds Binds
  "TAB" 'origami-recursively-toggle-node

  ;; Tabs Binds
  "tl"  'centaur-tabs-forward
  "th"  'centaur-tabs-backward
  "td"  'centaur-tabs-do-close

  ;; Winmove
  "wH" 'windmove-left
  "wJ" 'windmove-down
  "wK" 'windmove-up
  "wL" 'windmove-right

  ;; Wincmd Binds
  "wh" 'evil-window-left
  "wj" 'evil-window-down
  "wk" 'evil-window-up
  "wl" 'evil-window-right
  "wd" 'evil-window-delete
  "wo" 'other-window
  "ws" 'split-window-vertically
  "w|" 'split-window-horizontally
  "w<" 'windresize-left
  "w>" 'windresize-right
  "w+" 'windresize-up
  "w-" 'windresize-down
  )

;; G BINDS +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
(general-def
  :states 'normal
  :keymaps 'override
  :prefix "g"

  "t" 'helm-imenu
  "s" 'helm-swoop
  "o" 'helm-occur
  ;"k" 'helm-show-kill-ring
  "f" 'helm-find-files
  "p" 'helm-projectile-find-file

  )
;; INSERT ONLY BINDS +++++++++++++++++++++++++++++++++++++++++++++++++++++
(general-def
  :states 'insert
  :keymaps 'override
					;"<escape>"   'keyboard-quit
  "<space>"    '(lambda () (interactive) (insert " "))
  "C-SPC"      'company-complete
  )

;; ALL BINDS +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
(general-def
  :states '(insert normal visual emacs global)
  :keymaps 'override

  ;"<mouse-4>"    'evil-previous-line
  ;"<mouse-5>"   'evil-next-line
  )

;; COMPANY BINDS +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
(general-def
  :keymaps 'company-active-map

  "SPC"   nil
  "RET"   'company-complete-selection
  )

;; MODE SPECIFIC EVIL BINDS
;; ORG BINDS +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
(general-def
  :states 'normal
  :keymaps 'org-mode-map
  :prefix "g"

  "mj" 'pdf-page-down
  "mk" 'pdf-page-up
  )

(general-def
  :states 'normal
  :keymaps 'org-mode-map
  :prefix "SPC"

  "ms" 'org-download-screenshot
  )
